<% presenter.control_state_change do |states| %>
  <%= section do %>
    <%= semantic_form_for(presenter.lab_ware, presenter.lab_ware_form_details(self).merge(:html => {:method => :put})) do |f| %>
      <%= f.inputs do %>
        <p>
          <label class="ui-select">Current State</label>
          <%= presenter.lab_ware.state.titleize %>
        </p>
        <p>
          <%= label_tag :state, "New State" %>
          <%= select_tag :state, options_for_select(states.map { |s| [ s.titleize, s ] }, states.first) %>
        </p>
        <p id="cancelled" class="reason">
          <%= label_tag :reason, 'Reason for cancelling' %>
          <%= select_tag(:reason, options_for_select([ 'Contaminated', 'Incorrect protocol used', 'Not required' ]), :disabled => true) %>
        </p>
        <p id="failed" class="reason">
          <%= label_tag :reason, 'Reason for failure' %>
          <%= select_tag(:reason, options_for_select([ 'Equipment failure', 'Poor yield', 'Power failure', 'Reagent failure' ]), :disabled => true) %>
        </p>
        <%= f.commit_button 'Change State' %>

        <script type="text/javascript" charset="utf-8">
          (function($, undefined) {
            displayReason = function() {
              $('.reason').removeClass('show').find('select').attr('disabled', 'disabled');
              $('#' + $('#state option:selected').attr('value')).addClass('show').find('select:disabled').removeAttr('disabled');
            };

            displayReason();
            $('#state').change(displayReason);
          })($);
        </script>
      <% end %>
    <% end %>
  <% end %>
<% end %>
